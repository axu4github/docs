# 阿里云平台迁移计划

> **注意：** 本文档工作量并未涉及阿里云平台部署所需要时间。

## 存储迁移

### 语音数据（文件系统，HDFS）

#### 构成

- 1. 原始语音文件（包括`语音数据`和`语音索引`）（备份使用）
- 2. 处理后语音文件

#### 迁移至组件

 - `HDFS` 迁移至 [`OSS`](https://www.aliyun.com/product/oss/?spm=5176.54465.212901.15.o4aF0d)

#### 涉及功能

- 1. 数据归集，原始语音文件的写入
- 2. 数据归集，处理后语音文件的写入
- 3. 语音调听，语音文件读取

#### 工作量

- 3 人天

### 索引数据（HDFS，Hive，Solr，Hbase）

#### 构成

- 1. 业务索引（客户原始索引，比如：机构名称等）
- 2. 系统索引（系统处理时生成索引，比如：语音大小、时长、存储路径等）
- 3. 语音引擎索引（语音引擎处理时生成索引，比如：通话内容等）

#### 迁移至组件

- 1. `HDSF` 迁移至 [`OSS`](https://www.aliyun.com/product/oss/?spm=5176.54465.212901.15.o4aF0d)
- 2. `Hive` 迁移至 [`ODPS`](https://www.aliyun.com/product/odps/)
- 3. `Solr` 不迁移（因无对应组件）
- 4. `Hbase` 迁移至 [`表格存储`](https://www.aliyun.com/product/ots?spm=5176.product27278.416540.45.Q9xkOO)

#### 涉及功能

- 1. 数据归集，处理后的索引平面文件写入`OSS`中
- 2. 数据归集，处理后的索引内容写入`ODPS表`中（包括`ODPS表`创建）
- 3. 数据归集，处理后的索引内容写入`表格存储`中
- 4. 语音检索，根据检索得到的`id`从`表格存储`中读取全部索引信息
- 5. 语音调听，根据`id`从`表格存储`中读取语音存储路径
- 6. 语音质检，计算数据存储45天以上的质检任务时，从`ODPS表`中检索索引信息（风险点）

#### 工作量

- 5 人天

### 临时数据（文件系统，MFS）

#### 构成

- 1. 日志
- 2. 临时数据
- 3. 共享数据

#### 迁移至组件

- `MFS` 迁移至 [`文件存储`](https://www.aliyun.com/product/nas?spm=5176.54465.416540.48.o4aF0d)

#### 涉及功能

- 所有 `MFS` 组件支持的功能

#### 工作量

- 无

### 其他数据（Mysql，Redis，MongoDB）

- 该部分数据主要包括 `任务调度数据`，`监控数据`，`缓存数据`等等。由于使用方式复杂多样，所以不迁移至阿里云平台。

## 计算迁移

### 质检45天之前的数据

- 不迁移

### 质检45天之后的数据（Hive）

> **风险点：** `ODPS` 是否可以完全支持现在项目中 `Hive` 所使用 `UDF` 和  `SQL`。

#### 迁移至组件

- Hive 迁移至 [`ODPS`](https://www.aliyun.com/product/odps/)

#### 工作量

- 3 人天

## 测试

#### 工作项

- 1. 功能测试，保证迁移功能点功能正确。
- 2. 整体测试，保证系统所有功能正确。
- 3. 性能测试，保证处理时间在指定范围内，根据实际情况可能会针对阿里云平台具体组件进行扩容等。

#### 工作量

- 10 - 20 人天

## 总结

- 阿里云平台需使用如下组件：`ODPS` 代替 `Hive`, `OSS` 代替 `HDFS`, `表格存储` 代替 `Hbase`, `文件存储` 代理 `MFS`
- 若不考虑阿里云平台组件搭建的情况下，保守估计约31人天。


