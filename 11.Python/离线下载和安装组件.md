## 离线下载和安装组件

### 安装 `pip`

待补充

### 根据 `pip freeze` （`requirements.txt`） 的结果自动下载操作系统需要的组件

> **特别注意：执行自动下载命令时，一定要在和目标操作系统完全一致的操作系统上执行。（因为它会根据当前操作系统版本下的组件包）**

```bash
> pwd
/tmp/learn_solrcloud_python_client

> mkdir -p /tmp/learn_solrcloud_python_client/packages
> ll /tmp/learn_solrcloud_python_client/
total 20
drwxr-xr-x 2 root root 4096 Aug 18 16:39 packages
-rw-r--r-- 1 root root  581 Aug 18 16:28 requirements.txt
-rw-r--r-- 1 root root  470 Aug 18 16:28 solr_actions.py
-rw-r--r-- 1 root root 1027 Aug 18 16:28 solr_actions.pyc
-rw-r--r-- 1 root root 1128 Aug 18 16:28 solrcloud_maintenances.py

# 执行自定下载组件命令
# 注：如果网络不好的情况下会出现 `Time Out` 错误，不需要担心该命令可以重复执行。
# 直到所有包都下载完毕为止。
> pip install --download packages -r requirements.txt
[...]
Downloading appnope-0.1.0-py2.py3-none-any.whl
  Saved ./packages/appnope-0.1.0-py2.py3-none-any.whl
Collecting asn1crypto==0.22.0 (from -r requirements.txt (line 2))
  Downloading asn1crypto-0.22.0-py2.py3-none-any.whl (97kB)
    100% |████████████████████████████████| 102kB 24kB/s
  Saved ./packages/asn1crypto-0.22.0-py2.py3-none-any.whl
[...]
Saved ./packages/setuptools-36.2.7-py2.py3-none-any.whl
Successfully downloaded appnope asn1crypto backports.shutil-get-terminal-size bcrypt certifi cffi chardet cryptography decorator enum34 Fabric idna ipaddress ipython ipython-genutils paramiko pathlib2 pexpect pickleshare prompt-toolkit ptyprocess pyasn1 pycparser Pygments PyNaCl requests scandir semver simplegeneric six solrcloudpy traitlets urllib3 wcwidth setuptools

# 查看已下载组件
# 注意：该些组件是针对当前操作系统版本下载的，若目标服务器和当前服务器操作系统不一致，则无法保证可以正确安装
> ll packages/
total 9692
-rw-r--r-- 1 root root    3993 Aug 18 16:40 appnope-0.1.0-py2.py3-none-any.whl
-rw-r--r-- 1 root root   97896 Aug 18 16:40 asn1crypto-0.22.0-py2.py3-none-any.whl
[...]
-rw-r--r-- 1 root root  132332 Aug 22 11:00 urllib3-1.22-py2.py3-none-any.whl
-rw-r--r-- 1 root root   21014 Aug 22 11:00 wcwidth-0.1.7-py2.py3-none-any.whl

# 查看当前组件列表
> pip list
DEPRECATION: Python 2.6 is no longer supported by the Python core team, please upgrade your Python. A future version of pip will drop support for Python 2.6
DEPRECATION: The default format will switch to columns in the future. You can use --format=(legacy|columns) (or define a format=(legacy|columns) in your pip.conf under the [list] section) to disable this warning.
argparse (1.4.0)
pip (9.0.1)
setuptools (36.2.7)
wheel (0.29.0)

# 离线安装已经下载好的组件
> pwd
/tmp/learn_solrcloud_python_client

> ll
total 20
drwxr-xr-x 2 root root 4096 Aug 22 11:00 packages
-rw-r--r-- 1 root root  581 Aug 18 16:28 requirements.txt
-rw-r--r-- 1 root root  470 Aug 18 16:28 solr_actions.py
-rw-r--r-- 1 root root 1027 Aug 18 16:28 solr_actions.pyc
-rw-r--r-- 1 root root 1128 Aug 18 16:28 solrcloud_maintenances.py

# 执行离线安装命令
> pip install --no-index --find-links=packages/ -r requirements.txt
DEPRECATION: Python 2.6 is no longer supported by the Python core team, please upgrade your Python. A future version of pip will drop support for Python 2.6
Collecting appnope==0.1.0 (from -r requirements.txt (line 1))
Collecting asn1crypto==0.22.0 (from -r requirements.txt (line 2))
Collecting backports.shutil-get-terminal-size==1.0.0 (from -r requirements.txt (line 3))
Collecting bcrypt==3.1.3 (from -r requirements.txt (line 4))
Collecting certifi==2017.7.27.1 (from -r requirements.txt (line 5))
[...]
Collecting solrcloudpy==2.4.1 (from -r requirements.txt (line 31))
Collecting traitlets==4.3.2 (from -r requirements.txt (line 32))
Collecting urllib3==1.22 (from -r requirements.txt (line 33))
Collecting wcwidth==0.1.7 (from -r requirements.txt (line 34))
Requirement already satisfied: setuptools>=18.5 in /root/virtualenv/learn_solrcloud_python_client/lib/python2.6/site-packages (from ipython==5.4.1->-r requirements.txt (line 14))
Building wheels for collected packages: pycparser, PyNaCl, scandir, semver, simplegeneric, solrcloudpy
  Running setup.py bdist_wheel for pycparser ... done
  Stored in directory: /root/.cache/pip/wheels/94/58/41/2524045dffff5f2c26f90774ef02a271fe3156f6beca121a74
  Running setup.py bdist_wheel for PyNaCl ... done
  Stored in directory: /root/.cache/pip/wheels/c4/29/ab/a325fc1e89f96f6eb519d50f83b8576fa6647faebbab12f0bc
  Running setup.py bdist_wheel for scandir ... done
  Stored in directory: /root/.cache/pip/wheels/ed/5e/f7/7256ef3879d106cc88b32f3d3998bb7b2b5754a4e0a801c838
  Running setup.py bdist_wheel for semver ... done
  Stored in directory: /root/.cache/pip/wheels/6a/58/1e/e129df302ba5d2fbf6774ed27f9f50d99372202b4015ad3403
  Running setup.py bdist_wheel for simplegeneric ... done
  Stored in directory: /root/.cache/pip/wheels/b5/60/33/05fa5d3d6b11828fcff3d06a0d562d33e95521ca6c919c8703
  Running setup.py bdist_wheel for solrcloudpy ... done
  Stored in directory: /root/.cache/pip/wheels/a7/42/50/7e6734be07b88bf1c198458ead2432de3efc6630a5c91a52ec
Successfully built pycparser PyNaCl scandir semver simplegeneric solrcloudpy
Installing collected packages: appnope, asn1crypto, backports.shutil-get-terminal-size, six, pycparser, cffi, bcrypt, certifi, chardet, idna, ipaddress, enum34, cryptography, decorator, pyasn1, PyNaCl, paramiko, Fabric, Pygments, ipython-genutils, traitlets, simplegeneric, scandir, pathlib2, pickleshare, wcwidth, prompt-toolkit, ptyprocess, pexpect, ipython, urllib3, requests, semver, solrcloudpy
Successfully installed Fabric-1.13.2 PyNaCl-1.1.2 Pygments-2.2.0 appnope-0.1.0 asn1crypto-0.22.0 backports.shutil-get-terminal-size-1.0.0 bcrypt-3.1.3 certifi-2017.7.27.1 cffi-1.10.0 chardet-3.0.4 cryptography-2.0.3 decorator-4.1.2 enum34-1.1.6 idna-2.6 ipaddress-1.0.18 ipython-5.4.1 ipython-genutils-0.2.0 paramiko-2.2.1 pathlib2-2.3.0 pexpect-4.2.1 pickleshare-0.7.4 prompt-toolkit-1.0.15 ptyprocess-0.5.2 pyasn1-0.3.2 pycparser-2.18 requests-2.18.4 scandir-1.5 semver-2.7.7 simplegeneric-0.8.1 six-1.10.0 solrcloudpy-2.4.1 traitlets-4.3.2 urllib3-1.22 wcwidth-0.1.7

# 检查
> pip list
DEPRECATION: Python 2.6 is no longer supported by the Python core team, please upgrade your Python. A future version of pip will drop support for Python 2.6
DEPRECATION: The default format will switch to columns in the future. You can use --format=(legacy|columns) (or define a format=(legacy|columns) in your pip.conf under the [list] section) to disable this warning.
appnope (0.1.0)
argparse (1.4.0)
asn1crypto (0.22.0)
backports.shutil-get-terminal-size (1.0.0)
bcrypt (3.1.3)
certifi (2017.7.27.1)
cffi (1.10.0)
chardet (3.0.4)
cryptography (2.0.3)
decorator (4.1.2)
enum34 (1.1.6)
Fabric (1.13.2)
idna (2.6)
ipaddress (1.0.18)
ipython (5.4.1)
ipython-genutils (0.2.0)
paramiko (2.2.1)
pathlib2 (2.3.0)
pexpect (4.2.1)
pickleshare (0.7.4)
pip (9.0.1)
prompt-toolkit (1.0.15)
ptyprocess (0.5.2)
pyasn1 (0.3.2)
pycparser (2.18)
Pygments (2.2.0)
PyNaCl (1.1.2)
requests (2.18.4)
scandir (1.5)
semver (2.7.7)
setuptools (36.2.7)
simplegeneric (0.8.1)
six (1.10.0)
solrcloudpy (2.4.1)
traitlets (4.3.2)
urllib3 (1.22)
wcwidth (0.1.7)
wheel (0.29.0)
```

## 问题解决

### `error: Setup script exited with error: command ‘gcc’ failed with exit status 1`

**问题**

在执行 `pip install --download packages -r requirements.txt` 命令时出现 `error: Setup script exited with error: command ‘gcc’ failed with exit status 1`

**解决方法**

- `yum -y install gcc`
- `yum -y install python-devel`
- `yum install -y zlib-dev openssl-devel sqlite-devel bzip2-devel libxslt-devel libffi-devel`
